<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Perfil - Panader칤a Navide침a</title>
  <link rel="stylesheet" href="/css/perfil.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
  <div class="header">
    <div class="header-content">
      <h1>游볧 Panader칤a La Desesperanza</h1>
      <div class="nav-links">
        <a href="/productos.html">Productos</a>
        <a href="/carrito.html">Carrito</a>
        <a href="/perfil.html">Mi Perfil</a>
        <button class="btn-logout" onclick="cerrarSesion()">Cerrar Sesi칩n</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="form-container">
      <h2>游녻 Mi Perfil</h2>
      <div id="perfilInfo"></div>

      <div id="adminLink" style="display: none; text-align: center; margin-top: 30px;">
        <a href="/admin.html" class="btn btn-secondary">游 Panel de Administraci칩n</a>
      </div>
    </div>
  </div>

  <footer class="footer">
<div class="footer-container">
<div class="footer-brand">
<h3>游볧 Panader칤a La Desesperanza</h3>
<p>Hecho con amor, mantequilla y esp칤ritu navide침o.</p>
</div>
<div class="footer-contact">
<h4>Contacto</h4>
<p>游늸 Z칩calo, Centro Hist칩rico, CDMX</p>
<p>游 55 0000 0000</p>
<p>九괦잺 panaderialadesesperanza@gmail.com</p>
</div>
</div>

<div class="footer-mapa">
<h4>游늸 Encu칠ntranos</h4>
<div id="mapa" style="height: 300px; border-radius: 15px; overflow: hidden;"></div>
</div>

<div class="footer-bottom">
춸 2026 Panader칤a La Desesperanza 췅 Todos los derechos reservados
</div>
</footer>

<script>
if (document.getElementById('mapa')) {
  const mapa = L.map('mapa').setView([19.4326, -99.1332], 16);
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '춸 OpenStreetMap contributors'
  }).addTo(mapa);
  
  const marker = L.marker([19.4326, -99.1332]).addTo(mapa);
  marker.bindPopup('<b>游볧 Panader칤a La Desesperanza</b><br>Z칩calo, Centro Hist칩rico').openPopup();
}
</script>

  <script>
    async function cargarPerfil() {
      try {
        const res = await fetch('/api/auth/perfil');
        if (!res.ok) {
          window.location.href = '/login.html';
          return;
        }

        const usuario = await res.json();

        document.getElementById('perfilInfo').innerHTML = `
          <div class="form-group">
            <label>Nombre Completo:</label>
            <input type="text" value="${usuario.nombre} ${usuario.apellido}" readonly>
          </div>
          <div class="form-group">
            <label>Correo:</label>
            <input type="email" value="${usuario.correo}" readonly>
          </div>
          <div class="form-group">
            <label>ID de Cliente:</label>
            <input type="text" value="${usuario.id}" readonly>
          </div>
        `;

        if (usuario.isAdmin) {
          document.getElementById('adminLink').style.display = 'block';
        }
      } catch (error) {
        console.error('Error:', error);
        window.location.href = '/login.html';
      }
    }

    async function cerrarSesion() {
      await fetch('/api/auth/logout', { method: 'POST' });
      window.location.href = '/login.html';
    }

    cargarPerfil();
  </script>
</body>

</html>